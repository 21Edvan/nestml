/* * Copyright (c) 2015 RWTH Aachen. All rights reserved. * * http://www.se-rwth.de/ */package org.nest.spl.prettyprinter;import org.junit.Test;import org.nest.base.ModebasedTest;import org.nest.spl._ast.ASTSPLFile;import org.nest.spl._parser.SPLParser;import org.nest.spl._symboltable.SPLLanguage;import java.io.IOException;import java.io.StringReader;import java.nio.file.Path;import java.nio.file.Paths;import java.util.List;import java.util.Optional;import static org.junit.Assert.assertTrue;import static org.nest.utils.FileHelper.collectFiles;/** * Checks that the pretty printed result can be parsed again. * * @author plotnikov */public class SPLPrettyPrinterTest extends ModebasedTest {  private final SPLParser splFileParser = new SPLParser();  private final ExpressionsPrettyPrinter prettyPrinter = new ExpressionsPrettyPrinter();  private Optional<ASTSPLFile> parseStringAsSPLFile(final String fileAsString) throws IOException {    return splFileParser.parse(new StringReader(fileAsString));  }  @Test  public void testThatPrettyPrinterProducesParsableOutput() throws IOException {    final SPLPrettyPrinter splPrettyPrinter = new SPLPrettyPrinter(prettyPrinter);    final Optional<ASTSPLFile> root = splFileParser.parse        //("src/test/resources/org/nest/spl/parsing/modelContainingAllLanguageElements.simple");        ("src/test/resources/org/nest/spl/parsing/complexExpressions.simple");    assertTrue(root.isPresent());    root.get().accept(splPrettyPrinter); // starts prettyPrinter    Optional<ASTSPLFile> prettyPrintedRoot = parseStringAsSPLFile(splPrettyPrinter.getResult());    assertTrue(prettyPrintedRoot.isPresent());    System.out.println(splPrettyPrinter.getResult());  }  @Test  public void testAllModelsForParser() throws IOException {    parseAndCheckSPLModelsFromFolder("src/test/resources/org/nest/spl/parsing");  }  @Test  public void testAllModelsForCocos() throws IOException {    parseAndCheckSPLModelsFromFolder("src/test/resources/org/nest/spl/cocos");  }  private void parseAndCheckSPLModelsFromFolder(final String folderPath) throws IOException {    final List<Path> splFiles = collectFiles(        Paths.get(folderPath),        model -> model.endsWith(SPLLanguage.FILE_ENDING));    for (final Path splModelFile : splFiles) {      System.out.println("Handles the model: " + splModelFile);      final SPLPrettyPrinter splPrettyPrinter = new SPLPrettyPrinter(prettyPrinter);      final Optional<ASTSPLFile> splModelRoot = splFileParser.parse(splModelFile.toString());      assertTrue("Cannot parse the model: " + splModelFile, splModelRoot.isPresent());      splModelRoot.get().accept(splPrettyPrinter);      //System.out.println(splPrettyPrinter.getResult());      Optional<ASTSPLFile> prettyPrintedRoot = parseStringAsSPLFile(splPrettyPrinter.getResult());      assertTrue(prettyPrintedRoot.isPresent());    }  }}